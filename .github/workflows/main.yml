name: Deploy Databricks Notebook

on:
  push:
    branches:
      - main   # Trigger when code is merged to main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. Set up Databricks CLI
      - name: Install Databricks CLI
        uses: databricks/setup-cli@v1

      # 3. Deploy bundle to test environment
      - run: databricks bundle deploy
         working_directory:main
           DATABRICKS_HOST= ${{ secrets.DEV-DEPLOYMENT-TARGET-URL}} >> $GITHUB_ENV
          DATABRICKS_TOKEN= ${{ secrets.dev-token}}>> $GITHUB_ENV
          WORKSPACE_NOTEBOOK_PATH= "/Workspace/Repos/gurralasushmareddy@gmail.com/CICD-DATABRICKS-PROJECT"

           run_pipeline:
           name: "Run Databricks job After deployment"
           runs-on:  ubuntu-latest
           needs: deploy_to_prod

           steps:
             - uses: actiona/checkout@v3
             -uses: databricks/setup-cli@main
             #4.Run the databricks job defined in the bundle
              run: databricks bundle deploy run my-job-refresh-all
           working_directory:prod
           DATABRICKS_HOST= ${{ secrets.prod-DEPLOYMENT-TARGET-URL}} >> $GITHUB_ENV
          DATABRICKS_TOKEN= ${{ secrets.prod-token}}>> $GITHUB_ENV
          WORKSPACE_NOTEBOOK_PATH= "/Workspace/Repos/gurralasushmareddy@gmail.com/CICD-DATABRICKS-PROJECT"

             


